<section class="checkout" *ngIf="!loading && products">
    <div class="checkout-container">
        <div class="pay">
            <header class="pay-header">
                <svg class="icon" id="ripley_com" viewBox="0 0 89.29 128.82">
                    <path d="M89.27 95.24c0-.63-.8-.82-.8-.82-8-1.48-15.47-7.05-21.12-13a138.74 138.74 0 01-20-27.73c-.89-2.07.38-2.29.38-2.29 15.59-6 18.16-21.57 18.16-25.83C65.87 5.83 47.19 0 30.35 0 24 0 21.87.53 15.25.53 7.55.53 2.92 0 1.73 0A1.82 1.82 0 000 2c0 4.76 10.87-3.33 10.87 12.58v63.48C10.87 92.77.53 88.67.53 92.25c0 1.2 1.32 1.59 2.11 1.59 3.85 0 8.22-.53 14.45-.53 7.83 0 9.81.53 14.32.53 3.31 0 3.84-.66 3.84-1.59 0-4.5-13.91 2.39-13.91-16.7V8.62c0-4 2.92-4 7.16-4 15.24 0 27.3 8.49 27.56 24.52.18 10.87-8 21.19-21.47 21.19a23.53 23.53 0 01-4.78-.28c-.66 0-1.33.27-1.33 1.19 0 1.21 1 1.84 2.13 2.17 1.49.65 4.9 1.19 8.45 6.65 9 14.8 19.2 37 42.39 37 8.68 0 7.8-1 7.8-1.82M1.45 124.85a4 4 0 114 4 4 4 0 01-4-4zM10.83 117.8a10.81 10.81 0 0111.05-11 10.74 10.74 0 019.43 5.34l-5.46 3.17a4.32 4.32 0 00-4-2.34 4.84 4.84 0 000 9.68 4.28 4.28 0 004-2.34l5.46 3.13a10.65 10.65 0 01-9.43 5.38 10.81 10.81 0 01-11.05-11.02zM32.35 117.8a11.06 11.06 0 1111.05 11 10.93 10.93 0 01-11.05-11zm15.85 0a4.8 4.8 0 10-4.8 4.92 4.68 4.68 0 004.81-4.92zM89.29 115.43v12.81H83V116c0-2.09-1-3.42-3-3.42s-3.25 1.46-3.25 3.92v11.76h-6.23V116c0-2.09-1-3.42-3-3.42s-3.25 1.46-3.25 3.92v11.76H58v-20.89h6.26v1.92c1-1.42 2.79-2.5 5.59-2.5a6.21 6.21 0 015.46 2.75c1.17-1.67 3.09-2.75 6-2.75 4.86 0 7.98 3.42 7.98 8.64z"></path>
                </svg>
                <h2 class="title">Carro de compra</h2>
            </header>
            <form class="pay-form" [formGroup]="pay" (ngSubmit)="payItems(pay.value, payBtn)">
                <h3 class="title">Datos personales</h3>
                <div class="container">
                    <div class="fields">
                        <label class="fields-label">Nombres</label>
                        <input 
                            type="text" 
                            placeholder="Ingrese sus nombres" 
                            class="fields-input" 
                            formControlName="name" 
                            [class.fields-input--error]="pay.get('name').invalid && pay.get('name').touched"
                        >
                        <div *ngIf="pay.get('name').invalid && pay.get('name').touched">
                            <div class="fields-error" *ngIf="pay.get('name').hasError('required')">Campo requerido</div>
                        </div>
                    </div>
                    <div class="fields">
                        <label class="fields-label">Apellidos</label>
                        <input 
                            type="text" 
                            placeholder="Ingrese sus apellidos" 
                            class="fields-input" 
                            formControlName="lastName" 
                            [class.fields-input--error]="pay.get('lastName').invalid && pay.get('lastName').touched"
                        >
                        <div *ngIf="pay.get('lastName').invalid && pay.get('lastName').touched">
                            <div class="fields-error" *ngIf="pay.get('lastName').hasError('required')">Campo requerido</div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="fields">
                        <label class="fields-label">Correo electronico</label>
                        <input 
                            type="text" 
                            placeholder="Ingrese su correo electronico" 
                            class="fields-input" 
                            formControlName="email"
                            [class.fields-input--error]="pay.get('email').invalid && pay.get('email').touched"
                        >
                        <div *ngIf="pay.get('email').invalid && pay.get('email').touched">
                            <div class="fields-error" *ngIf="pay.get('email').hasError('required')">
                                Campo requerido
                            </div>
                            <div class="fields-error" *ngIf="pay.get('email').hasError('email')">
                                Correo electronico Incorrecto
                            </div>
                        </div>
                    </div>
                    <div class="fields">
                        <label class="fields-label">Rut</label>
                        <input 
                            type="text" 
                            placeholder="Ej: 11111111-1" 
                            class="fields-input" 
                            formControlName="rut"
                            [class.fields-input--error]="pay.get('rut').invalid && pay.get('rut').touched"
                        >
                        <div *ngIf="pay.get('rut').invalid && pay.get('rut').touched">
                            <div class="fields-error" *ngIf="pay.get('rut').hasError('required')">
                                Campo requerido
                            </div>
                            <div class="fields-error" *ngIf="pay.get('rut').hasError('pattern')">
                                Rut Incorrecto
                            </div>
                        </div>
                    </div>
                </div>
                <h3 class="title">Datos de pago</h3>
                <div class="container">
                    <div class="fields">
                        <label class="fields-label">Número de tarjeta</label>
                        <input 
                            type="text" 
                            placeholder="Ingrese su número de tarjeta" 
                            class="fields-input" 
                            formControlName="cardNumber"
                            [class.fields-input--error]="pay.get('cardNumber').invalid && pay.get('cardNumber').touched"
                        >
                        <div *ngIf="pay.get('cardNumber').invalid && pay.get('cardNumber').touched">
                            <div class="fields-error" *ngIf="pay.get('cardNumber').hasError('required')">Campo requerido</div>
                        </div>
                    </div>
                    <div class="fields">
                        <label class="fields-label">CVV</label>
                        <input 
                            type="text" 
                            placeholder="Ingrese su cvv" 
                            class="fields-input" 
                            formControlName="cvv"
                            [class.fields-input--error]="pay.get('cvv').invalid && pay.get('cvv').touched"
                        >
                        <div *ngIf="pay.get('cvv').invalid && pay.get('cvv').touched">
                            <div class="fields-error" *ngIf="pay.get('cvv').hasError('required')">Campo requerido</div>
                        </div>
                    </div>
                </div>
                <footer class="footer">
                    <button class="footer-pay" [disabled]="pay.invalid" #payBtn>Finalizar Compra</button>
                </footer>
            </form>
        </div>
        <div class="detail">
            <header class="detail-header">
                <h3 class="title">Detalle de la compra</h3>
            </header>
            <div class="detail-products">
                <div class="product" *ngFor="let product of products">
                    <div class="product-detail">
                        <img [src]="product.picture" [alt]="product.name" class="picture">
                        <div class="info">
                            <span class="info-name">{{ product.name }}</span>
                            <span class="info-quantity">Cantidad: {{ product.quantity }}</span>
                            <span class="info-sku">sku: {{ product.sku }}</span>
                        </div>
                    </div>
                    <div class="product-price">
                        <div class="price">
                            <span class="price-label">Precio unidad</span>
                            <span class="price-value">${{ product.maxPrice | money }}</span>
                        </div>
                        <div class="price price--card">
                            <span class="price-label">Tarjeta Ripley</span>
                            <span class="price-value">${{ product.minPrice | money }}</span>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="detail-footer">
                <h3 class="title">Resumen</h3>
            </footer>
            <div class="detail-summary">
                <div class="subtotal">
                    <span class="subtotal-label">Subtotal</span>
                    <span class="subtotal-value">${{ subtotal | money }}</span>
                </div>
                <div class="total">
                    <div class="total-value">
                        <span class="label">Total normal</span>
                        <span class="value">${{ subtotal | money }}</span>
                    </div>
                    <div class="total-value total-value--ripley">
                        <span class="label">Total Tarjeta Ripley</span>
                        <span class="value">${{ totalDiscount | money }}</span>
                    </div>
                </div>
            </div>
            <a class="detail-continue" [routerLink]="['/products']">Seguir comprando</a>
        </div>
    </div>
</section>
<div class="loading" *ngIf="loading">
    <app-loading [loading]="loading"></app-loading>
</div>